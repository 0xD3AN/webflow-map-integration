!function(){const e="us-map",a={},t=e=>new Promise(((a,t)=>{if([...document.scripts].some((a=>a.src===e)))return a();const o=document.createElement("script");o.src=e,o.async=!0,o.onload=()=>a(),o.onerror=a=>{t(new Error(`Failed to load script ${e}\nReason: ${a.message||"unknown error"}`))},document.head.appendChild(o)}));window.initUSMap=async function(o={}){window.am5&&window.am5map&&window.am5geodata_usaLow||(await t("https://cdn.amcharts.com/lib/5/index.js"),await t("https://cdn.amcharts.com/lib/5/map.js"),await t("https://cdn.amcharts.com/lib/5/geodata/usaLow.js"),await t("https://cdn.amcharts.com/lib/5/themes/Animated.js")),am5.ready((function(){var t=am5.Root.new(e);t.setThemes([am5themes_Animated.new(t)]);var o=t.container.children.push(am5map.MapChart.new(t,{panX:"rotateX",projection:am5map.geoAlbersUsa()})),n=o.series.push(am5map.MapPolygonSeries.new(t,{geoJSON:am5geodata_usaLow,fill:am5.color(4210752),stroke:am5.color(16777215)}));n.mapPolygons.template.setAll({tooltipText:"{name}"}),n.mapPolygons.template.states.create("hover",{fill:am5.color(13939820)});var i=t.tooltipContainer.children.push(am5.Button.new(t,{x:am5.p100,y:0,centerX:am5.p100,centerY:0,paddingTop:18,paddingBottom:18,paddingLeft:12,paddingRight:12,dx:-20,dy:20,themeTags:["zoom"],icon:am5.Graphics.new(t,{themeTags:["button","icon"],strokeOpacity:.7,draw:function(e){e.moveTo(0,0),e.lineTo(12,0)}})}));i.get("background").setAll({cornerRadiusBL:40,cornerRadiusBR:40,cornerRadiusTL:40,cornerRadiusTR:40}),i.events.on("click",(function(){r&&r.hide(),o.goHome(),i.hide(),(r=m.US.series).show()})),i.hide();var r,m={},s={query_results:[{co_loc_n:"Lake Charles",MAIL_ST_PROV_C:"LA",LNGTD_I:"-93.2174000",LATTD_I:"30.2266000",mail_city_n:"Lake Charles"},{co_loc_n:"Gurnee",MAIL_ST_PROV_C:"IL",LNGTD_I:"-87.90200000",LATTD_I:"42.37030000",mail_city_n:"Gurnee"},{co_loc_n:"Gurnee",MAIL_ST_PROV_C:"IL",LNGTD_I:"-87.90200000",LATTD_I:"42.37030000",mail_city_n:"Gurnee"},{co_loc_n:"Rockville",MAIL_ST_PROV_C:"MD",LNGTD_I:"-77.15280000",LATTD_I:"39.08400000",mail_city_n:"Rockville"},{co_loc_n:"Houston",MAIL_ST_PROV_C:"TX",LNGTD_I:"-95.37010000",LATTD_I:"29.76010000",mail_city_n:"Houston"},{co_loc_n:"Flower Mound",MAIL_ST_PROV_C:"TX",LNGTD_I:"-97.09700000",LATTD_I:"33.01460000",mail_city_n:"Flower Mound"},{co_loc_n:"McAllen",MAIL_ST_PROV_C:"TX",LNGTD_I:"-98.23000000",LATTD_I:"26.20340000",mail_city_n:"McAllen"},{co_loc_n:"Waxahachie",MAIL_ST_PROV_C:"TX",LNGTD_I:"-96.84880000",LATTD_I:"32.38630000",mail_city_n:"Waxahachie"}]};function c(e){var a;return n.mapPolygons.each((function(t){t.dataItem.get("id")==e&&(a=t)})),a}function l(e){var a=o.series.push(am5map.MapPointSeries.new(t,{valueField:e,calculateAggregates:!0})),s=am5.Template.new(t);return a.bullets.push((function(){var e=am5.Container.new(t,{}),a=e.children.push(am5.Circle.new(t,{radius:10,fill:am5.color(9922863),fillOpacity:.7,cursorOverStyle:"pointer",tooltipText:"{name}:\n[bold]{locationCount} locations[/]"},s));e.children.push(am5.Label.new(t,{text:"{locationCount}",fill:am5.color(16777215),populateText:!0,centerX:am5.p50,centerY:am5.p50,textAlign:"center"}));return a.events.on("click",(function(e){var a=e.target.dataItem.dataContext;if("state"==a.type&&a.target){m[a.target].series||(m[a.target].series=l("count"),m[a.target].series.data.setAll(a.markerData)),r&&r.hide();var t=c("US-"+a.stateName);n.zoomToDataItem(t.dataItem),i.show(),(r=m[a.target].series).show()}})),am5.Bullet.new(t,{sprite:e})})),a.set("heatRules",[{target:s,dataField:"value",min:10,max:30,key:"radius"}]),a}n.events.on("datavalidated",(function(){var e,t;e=s,t=l("locationCountsByState"),m.US={markerData:[],series:t},r=m.US.series,am5.array.each(e.query_results,(function(e){var t={stateName:e.MAIL_ST_PROV_C,long:am5.type.toNumber(e.LNGTD_I),lat:am5.type.toNumber(e.LATTD_I),cityName:e.mail_city_n,geoKey:`${e.mail_city_n}|${e.MAIL_ST_PROV_C}`};if(a[t.geoKey]=(a[t.geoKey]||0)+1,a[t.stateName]=(a[t.stateName]||0)+1,null==m[t.stateName]){var o=c("US-"+t.stateName);if(!o)return;var n=o.visualCentroid();m[t.stateName]={target:t.stateName,type:"state",name:o.dataItem.dataContext.name,locationCount:a[t.stateName]||0,stateName:t.stateName,markerData:[],geometry:{type:"Point",coordinates:[n.longitude,n.latitude]}},m.US.markerData.push(m[t.stateName])}else m[t.stateName].locationCount++;null==m[t.cityName]?(m[t.cityName]={target:t.cityName,type:"city",name:t.cityName,locationCount:1,stateName:t.stateName,markerData:[],geometry:{type:"Point",coordinates:[t.long,t.lat]}},m[t.stateName].markerData.push(m[t.cityName])):m[t.cityName].locationCount++,m[t.cityName].markerData.push({name:t.cityName,locationCount:1,stateName:t.stateName,geometry:{type:"Point",coordinates:[t.long,t.lat]}})})),console.log(m.US.markerData),m.US.series.data.setAll(m.US.markerData)}))}))},document.addEventListener("DOMContentLoaded",(()=>{document.getElementById(e)?window.initUSMap():console.error("Unable to locate map element for init.")}))}();